# üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è OAuth —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ OAuth —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –≤ Photer API Gateway.

## üéØ –¶–µ–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã** –Ω–æ–≤—ã—Ö —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö OAuth —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
2. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** –¥–ª—è –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
4. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏** —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ callback –æ–±—Ä–∞–±–æ—Ç–∫–∏
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞** —Ç–µ—Å—Ç–∞–º–∏

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit —Ç–µ—Å—Ç—ã

#### AuthController —Ç–µ—Å—Ç—ã

- ‚úÖ **–°–æ–∑–¥–∞–Ω–æ:** `test/auth.controller.spec.ts`
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** OAuth —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ

#### OAuthStrategyFactory —Ç–µ—Å—Ç—ã

- ‚úÖ **–°–æ–∑–¥–∞–Ω–æ:** `test/oauth-strategy.factory.spec.ts`
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ

### 2. Integration —Ç–µ—Å—Ç—ã

#### OAuth Flow —Ç–µ—Å—Ç—ã

- üîÑ **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:** –ü–æ–ª–Ω—ã–π flow OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** Login ‚Üí Callback ‚Üí Token validation
- **–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### 3. E2E —Ç–µ—Å—Ç—ã

#### Browser —Ç–µ—Å—Ç—ã

- üîÑ **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** UI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
- **–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å        |
| ---------------------- | -------- | ------------- |
| AuthController         | 85%      | ‚úÖ –ì–æ—Ç–æ–≤–æ     |
| OAuthStrategyFactory   | 90%      | ‚úÖ –ì–æ—Ç–æ–≤–æ     |
| UniversalOAuthStrategy | 0%       | ‚ùå –ù–µ —Å–æ–∑–¥–∞–Ω–æ |
| –û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ         | 65%      | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ |

### –¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å        |
| ---------------------- | ---------------- | ------------- |
| AuthController         | 95%              | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ |
| OAuthStrategyFactory   | 95%              | ‚úÖ –ì–æ—Ç–æ–≤–æ     |
| UniversalOAuthStrategy | 90%              | ‚ùå –ù–µ —Å–æ–∑–¥–∞–Ω–æ |
| –û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ         | 90%              | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ |

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
yarn test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ OAuth
yarn test --testNamePattern="OAuth"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
yarn test --testNamePattern="AuthController"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Ñ–∞–±—Ä–∏–∫–∏
yarn test --testNamePattern="OAuthStrategyFactory"

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
yarn test:coverage

# –ó–∞–ø—É—Å–∫ –≤ watch —Ä–µ–∂–∏–º–µ
yarn test:watch
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–æ–ª—å–∫–æ OAuth —Ç–µ—Å—Ç—ã
yarn test --testNamePattern="OAuth"

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
yarn test --testNamePattern="validation"

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –æ—à–∏–±–æ–∫
yarn test --testNamePattern="error"
```

## üìù –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

#### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

- [x] Google OAuth
- [x] GitHub OAuth

#### ‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

- [x] Facebook (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É)
- [x] Twitter (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É)
- [x] –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É)
- [x] Null/undefined (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É)

### 2. OAuth Login —ç–Ω–¥–ø–æ–∏–Ω—Ç

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Login)

- [x] Google login - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ
- [x] GitHub login - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ

#### ‚ùå –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å –æ—à–∏–±–∫–∞–º–∏ (Login)

- [x] –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä - BadRequestException
- [x] –ü—É—Å—Ç–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä - BadRequestException
- [x] Null –ø—Ä–æ–≤–∞–π–¥–µ—Ä - BadRequestException

### 3. OAuth Callback —ç–Ω–¥–ø–æ–∏–Ω—Ç

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Callback)

- [x] Google callback - —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç
- [x] GitHub callback - —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç

#### ‚ùå –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å –æ—à–∏–±–∫–∞–º–∏ (Callback)

- [x] –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä - BadRequestException
- [x] –ü—É—Å—Ç–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä - BadRequestException
- [x] Null –ø—Ä–æ–≤–∞–π–¥–µ—Ä - BadRequestException

### 4. OAuthStrategyFactory

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Factory)

- [x] –°–æ–∑–¥–∞–Ω–∏–µ GoogleStrategy
- [x] –°–æ–∑–¥–∞–Ω–∏–µ GithubStrategy
- [x] –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

#### ‚ùå –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å –æ—à–∏–±–∫–∞–º–∏ (Factory)

- [x] –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä - Error
- [x] –ü—É—Å—Ç–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä - Error
- [x] Null/undefined –ø—Ä–æ–≤–∞–π–¥–µ—Ä - Error

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

### Jest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'node',
  roots: ['<rootDir>/test'],
  testMatch: ['**/*.spec.ts'],
  transform: {
    '^.+\\.ts$': 'ts-jest',
  },
  collectCoverageFrom: ['src/**/*.ts', '!src/**/*.d.ts'],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```env
# Test environment
NODE_ENV=test
JWT_SECRET=test-secret-key
FRONTEND_URL=http://localhost:3000

# Mock OAuth credentials
GOOGLE_CLIENT_ID=test-google-client-id
GOOGLE_CLIENT_SECRET=test-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:3001/api/v1/auth/oauth/google/callback

GITHUB_CLIENT_ID=test-github-client-id
GITHUB_CLIENT_SECRET=test-github-client-secret
GITHUB_CALLBACK_URL=http://localhost:3001/api/v1/auth/oauth/github/callback
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 80%
- **–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 90%
- **–¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 65%

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:** 60 —Å–µ–∫
- **–¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è:** 30 —Å–µ–∫
- **–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:** 45 —Å–µ–∫

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 20 —Ç–µ—Å—Ç–æ–≤
- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 30 —Ç–µ—Å—Ç–æ–≤
- **–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 15 —Ç–µ—Å—Ç–æ–≤

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Mock —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è Passport —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ jest.mock –¥–ª—è passport
- **–°—Ç–∞—Ç—É—Å:** üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### 2. OAuth callback —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
- **–†–µ—à–µ–Ω–∏–µ:** –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ Response –æ–±—ä–µ–∫—Ç–∞
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

- **–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö OAuth credentials
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mock –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ç–µ—Å—Ç–∞—Ö
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –¥–Ω—è)

1. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è UniversalOAuthStrategy**
2. **–î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã**
3. **–£–ª—É—á—à–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ AuthController**

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1 –Ω–µ–¥–µ–ª—è)

1. **–°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã**
2. **–î–æ–±–∞–≤–∏—Ç—å performance —Ç–µ—Å—Ç—ã**
3. **–£–ª—É—á—à–∏—Ç—å mock —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (2 –Ω–µ–¥–µ–ª–∏)

1. **–î–æ–±–∞–≤–∏—Ç—å load —Ç–µ—Å—Ç—ã**
2. **–°–æ–∑–¥–∞—Ç—å security —Ç–µ—Å—Ç—ã**
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å CI/CD pipeline**

## üìö –†–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Jest Testing Framework](https://jestjs.io/)
- [NestJS Testing](https://docs.nestjs.com/fundamentals/testing)
- [Passport.js Testing](http://www.passportjs.org/docs/)

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

- [AuthController —Ç–µ—Å—Ç—ã](./test/auth.controller.spec.ts)
- [OAuthStrategyFactory —Ç–µ—Å—Ç—ã](./test/oauth-strategy.factory.spec.ts)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-02  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
