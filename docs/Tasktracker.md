# Отслеживание прогресса разработки

## Задача: Исправление логики определения типа userIdentifier и авторизации профилей

- **Статус**: Завершена
- **Описание**: Исправить логику в методах getUserPosts и getProfileById для корректного определения типа идентификатора и исправить авторизацию endpoint профилей. Проблемы: 1) userIdentifier приходит как CUID (userId), но regex проверяет на UUID формат; 2) getProfileById не искал по userId; 3) endpoint /profile/:id был защищен guard и возвращал 404 для авторизованных пользователей.
- **Шаги выполнения**:
  - [x] Проанализировать текущую логику в posts.service.ts
  - [x] Определить причину проблемы (несоответствие формата CUID и UUID regex)
  - [x] Изменить логику getUserPosts: сначала искать пользователя по id, затем по username
  - [x] Изменить логику getProfileById: добавить поиск по userId
  - [x] Исправить авторизацию endpoint /profile/:id в profile.controller.ts
  - [x] Добавить подробные логи для отслеживания
  - [x] Обновить changelog.md
  - [x] Обновить tasktracker.md
- **Зависимости**: Зависит от схемы БД (CUID формат userId) и NestJS guard системы

## Задача: Изменение логики отображения профиля для авторизованного пользователя

- **Статус**: Завершена
- **Описание**: Реализовать логику, при которой авторизованный пользователь при клике на аватарку другого пользователя на главной странице видит профиль без деталей (как неавторизованный), чтобы сохранить приватность профилей. Изменение только в передаче Authorization header в запросе профиля.
- **Шаги выполнения**:
  - [x] Создать папку docs и базовые файлы документации
  - [x] Описать проект в Project.md
  - [x] Изменить логику в photer-app-dev/src/app/profile/[id]/page.tsx
  - [x] Исправить ошибку с отображением имени авторизованного пользователя вместо имени владельца
  - [x] Добавить новый API endpoint для получения постов по profileId
  - [x] Изменить URL fetch постов на /posts/profiles/{profileId}
  - [x] Обновить changelog.md
  - [x] Обновить Diary.md с наблюдениями
  - [ ] Протестировать изменение
- **Зависимости**: Зависит от существующей логики авторизации и API профилей

## Задача: Исправление проблемы с исчезновением постов при повторном заходе на страницу профиля

- **Статус**: Завершена
- **Описание**: Исправить критическую проблему в `usePostsList` хуке, где пустой кеш перезаписывал SSR данные, приводя к исчезновению постов при повторном заходе на страницу профиля
- **Шаги выполнения**:
  - [x] Проанализировать логику кеширования в `usePostsList.ts`
  - [x] Определить причину проблемы (пустой кеш перезаписывает SSR данные)
  - [x] Исправить инициализацию состояния: проверять наличие реальных данных в кеше
  - [x] Исправить useEffect: не перезаписывать SSR данные пустым кешем
  - [x] Исправить проверку владельца постов: добавить проверки на существование данных
  - [x] Обновить changelog.md
  - [x] Обновить tasktracker.md
- **Зависимости**: Зависит от логики SSR и Redux Toolkit Query кеширования

## Задача: Улучшение UI главной страницы

- **Статус**: Не начата
- **Описание**: Оптимизировать отображение постов и аватаров на главной странице для лучшего пользовательского опыта
- **Шаги выполнения**:
  - [ ] Анализ текущего UI
  - [ ] Предложения по улучшениям
  - [ ] Реализация изменений
- **Зависимости**: После завершения текущей задачи

## Задача: Добавление валидации загружаемых файлов

- **Статус**: В процессе
- **Описание**: Реализовать на клиенте проверку загружаемых для поста файлов. Валидация должна проверять размер (не более 20МБ) и тип файла (только JPEG и PNG).
- **Шаги выполнения**:
  - [x] Определить константы для максимального размера и разрешенных типов.
  - [x] Модифицировать `UploadStep.tsx` для добавления логики валидации.
  - [x] Добавить уведомления для пользователя в случае невалидных файлов.
  - [ ] Протестировать функционал.
- **Зависимости**: -

## Задача: Исправление обработки ошибок при создании поста

- **Статус**: Завершена
- **Описание**: Исправить неинформативный вывод ошибок в консоль (Ошибка: {}) при неудачной попытке создания поста. Заменить `console.error` на стандартизированный `errorHandler`.
- **Шаги выполнения**:
  - [x] Проанализировать стек вызовов ошибки.
  - [x] Локализовать проблему в хуке `usePostDescription.ts` и аналогичных компонентах.
  - [x] Заменить `console.error` на `errorHandler` в `CreatePostModal.tsx`.
  - [x] Заменить `console.error` на `errorHandler` в `usePostDescription.ts`.
  - [x] Сделать `errorHandler` более устойчивым к различным структурам ошибок.
  - [x] Обновить документацию.
- **Зависимости**: -

## Задача: Исправление ошибки 400 Bad Request при создании поста

- **Статус**: Завершена
- **Описание**: При попытке создать пост сервер возвращает ошибку 400. Это связано с тем, что файлы в `FormData` отправляются с неверным именем поля (`photos` вместо `files`).
- **Шаги выполнения**:
  - [x] Проанализировать логи и выявить ошибку 400.
  - [x] Сравнить `usePostDescription.ts` со старой реализацией `CreatePostModal.tsx`.
  - [x] Исправить имя поля для загрузки файлов с `photos` на `files` в `usePostDescription.ts`.
  - [x] Обновить документацию.
- **Зависимости**: -

## Задача: Исправление отображения постов в профиле

- **Статус**: Завершена
- **Описание**: Посты не отображаются в модальном окне при прямом заходе на URL поста. Проблема связана с некорректной передачей `postId` через компоненты.
- **Шаги выполнения**:
  - [x] Проанализировать логи и выявить, что `postId` не доходит до `PostsList`.
  - [x] Изменить `page.tsx` для передачи `postId` в `ProfileCard`.
  - [x] Модифицировать `ProfileCard.tsx` для приема и дальнейшей передачи `postId` в `PostsList`.
  - [x] Обновить документацию.
- **Зависимости**: -

## Задача: Исправление отображения фотографий в постах

- **Статус**: Завершена
- **Описание**: Фотографии не отображаются в постах, так как бэкенд возвращает относительные пути вместо полных URL.
- **Шаги выполнения**:
  - [x] Проанализировать `ViewPost.tsx` и `posts.service.ts`.
  - [x] Выявить, что `mapToPostOutputDto` не формирует полные URL.
  - [x] Модифицировать `mapToPostOutputDto` для добавления базового URL сервера к путям фотографий.
  - [x] Обновить документацию.
- **Зависимости**: -

## Задача: Добавление системы подписок

- **Статус**: Не начата
- **Описание**: Реализовать функционал подписок на пользователей
- **Шаги выполнения**:
  - [ ] Дизайн API для подписок
  - [ ] Создание таблиц в БД
  - [ ] Frontend компоненты
- **Зависимости**: После завершения базовых фич
