# Журнал изменений

## [2025-09-11] - Исправление логики определения типа userIdentifier, авторизации профилей и отображения постов

### Изменено

- Изменена логика метода `getUserPosts` в `posts.service.ts`: теперь сначала проверяется существование пользователя по `userIdentifier` как `userId`, затем по `username` через профиль
- Убрана зависимость от regex для определения типа идентификатора, что исправляет проблему с CUID форматом userId
- Добавлены подробные логи для отслеживания процесса поиска пользователя
- Изменена логика метода `getProfileById` в `profile.service.ts`: добавлен поиск по `userId` в дополнение к поиску по `username` и `profile.id`
- Улучшена логика поиска профилей для поддержки различных типов идентификаторов
- Исправлена авторизация endpoint `/profile/:id` в `profile.controller.ts`: убран `@UseGuards()` для обеспечения публичного доступа
- Исправлена логика в `usePostsList` хуке: улучшена приоритизация данных (cache > SSR > fallback)
- Добавлены debug логи в frontend компонентах для отслеживания передачи данных
- **Исправлена логика кеширования в `usePostsList.ts`**: предотвращено перезаписывание SSR данных пустым кешем, улучшена проверка существования данных в кеше

### Исправлено

- Исправлена проблема с поиском постов для авторизованного пользователя, когда `userIdentifier` приходит как CUID (userId), а не UUID
- Исправлена проблема с поиском профилей, когда идентификатор приходит как `userId`
- Исправлена проблема с доступом к чужим профилям для авторизованных пользователей (убрана защита guard)
- Исправлена проблема с отображением постов в профилях (улучшена логика обработки SSR и cache данных)
- Улучшена надежность определения типа идентификатора без использования regex
- **Исправлена критическая проблема с исчезновением постов при повторном заходе на страницу профиля** - пустой кеш больше не перезаписывает SSR данные

## [2025-09-11] - Изменение логики приватности профилей

### Изменено

- Изменена логика передачи Authorization header в запросе профиля: токен авторизации передаётся только если пользователь является владельцем профиля
- Для авторизованного пользователя, просматривающего чужой профиль с главной страницы, профиль отображается без деталей (как для неавторизованного)
- Исправлена ошибка с отображением имени авторизованного пользователя вместо имени владельца профиля
- Добавлен новый API endpoint `/posts/profiles/{profileId}` для получения постов по ID профиля
- Изменён URL fetch постов в page.tsx на `/posts/profiles/{profileId}`
- Добавлена документация проекта в папку docs/

### Добавлено

- Создан файл docs/Project.md с детальным описанием проекта
- Создан файл docs/Tasktracker.md для отслеживания задач
- Создан файл docs/Diary.md для ведения дневника разработки
- Создан файл docs/qa.md с вопросами по архитектуре
- Создан файл docs/codestyle.md с правилами кодстайла
- Добавлен метод `getUserPostsByProfileId` в posts.service.ts
- Добавлен endpoint `GET /posts/profiles/:profileId` в posts.controller.ts

### Исправлено

- Улучшена приватность профилей для авторизованных пользователей
- Исправлено отображение постов на странице чужого профиля
- Исправлено отображение имени владельца профиля вместо имени авторизованного пользователя
