# Дневник проекта Photer

## 2025-09-11

### Наблюдения

- Проект Photer развивается как социальная сеть для фото с Next.js фронтендом и NestJS бэкендом
- Текущая логика авторизации позволяет авторизованным пользователям видеть детали чужих профилей
- Пользователь хочет сделать профили более приватными для авторизованных пользователей на главной странице

### Решения

- Реализовано изменение в логике передачи Authorization header: токен передаётся только для владельца профиля
- Это позволяет авторизованному не-владельцу видеть профиль как неавторизованный (без деталей)
- Создана документация в папке docs для отслеживания прогресса

### Проблемы

- Возможные проблемы с кешированием данных профиля в Redux
- Необходимо протестировать изменение на всех сценариях использования
- Потенциальные вопросы с производительностью при частых запросах без токена

## 2025-09-11 (Продолжение)

### Наблюдения (2025-09-11)

- Изменение изолировано и не затрагивает другие компоненты
- Header и sidebar остаются без изменений
- Клик на посты работает как прежде

### Решения (2025-09-11)

- Продолжено создание документации
- Подготовлено изменение кода в page.tsx
- Исправлена ошибка с отображением имени авторизованного пользователя вместо имени владельца
- Добавлен новый API endpoint для получения постов по profileId

### Проблемы (2025-09-11)

- Необходимо убедиться, что изменение не ломает прямой доступ к профилям
- Требуется проверка на мобильных устройствах
- Требуется проверка на наличие постов у пользователей в базе данных

## 2025-09-18

### Наблюдения (2025-09-18)

- Установлены строгие правила работы с Git и отладочным кодом
- Пользователь выразил требование не выполнять операции без явного разрешения
- Необходимость в контроле над коммитами и отладочными логами

### Решения (2025-09-18)

- Добавлены правила в AGENTS.md:
  - Agent Guidelines с запретом на самостоятельные коммиты/пуши
  - Agent Guidelines с запретом на удаление debug логов без разрешения
  - Обновлен раздел Common Pitfalls to Avoid
- Обновлен docs/codestyle.md:
  - Добавлен раздел "Правила работы с Git"
  - Добавлен раздел "Правила работы с отладкой"
  - Добавлен раздел "Критически важные правила"
- Установлен процесс согласования для всех значимых операций

### Проблемы (2025-09-18)

- Необходимо строго соблюдать новые правила в будущей работе
- Требуется постоянный контроль за соблюдением ограничений
- Важно документировать все изменения перед коммитами

## 2025-09-18 (Продолжение) - Критическое исправление автоматического отображения фотографий

### Наблюдения (2025-09-18) - Проблема с фотографиями

- Обнаружена критическая проблема: фотографии не отображаются автоматически после создания поста
- Пользователи вынуждены перезагружать страницу вручную для просмотра загруженных фото
- Проблема затрагивает основной пользовательский опыт приложения
- Выявлено 8 взаимосвязанных проблем в разных частях системы

### Решения (2025-09-18) - Исправление фотографий

#### Архитектурные изменения

- Внедрена система флагов в Redux для отслеживания состояния создания поста
- Переписана логика приоритетов между кэшем и SSR данными
- Реализована многоуровневая инвалидация кэша
- Добавлено принудительное обновление данных после создания поста

#### Технические исправления

- Исправлена раздача статических файлов в NestJS backend
- Устранены проблемы с порядком выполнения операций в Redux
- Исправлено получение данных пользователя из state
- Удален несуществующий метод RTK Query

#### Отладочная система

- Добавлены подробные логи для диагностики проблем
- Внедрена система отслеживания состояния кэша
- Созданы timestamp логи для анализа последовательности операций

### Проблемы (2025-09-18) - Технические сложности

- Сложность взаимосвязей между frontend и backend компонентами
- Необходимость синхронизации состояния между SSR и client-side рендерингом
- Важность правильной настройки кэширования в RTK Query
- Критичность порядка выполнения операций в Redux

### Результаты

- **Решено 8 критических проблем** в системе отображения фотографий
- Фотографии теперь появляются автоматически сразу после создания поста
- Улучшена общая архитектура системы кэширования
- Повышен пользовательский опыт приложения
- Создана надежная система отладки для будущих проблем
